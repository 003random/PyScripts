# Description
# Searches for a given text in all the webservice methods

# Parameters
# Parameter 1: Input file with all the webservices
# Parameter 2: Session cookie
# Parameter 2: The search text

# Additional
# Replace [Host] with the host
# Replace [Cookie_Name] with the session cookie's name

import requests, sys, re

input_file = sys.argv[1]
cookie = sys.argv[2]
search = sys.argv[3]
baseUrl = 'https://[Host]/Services/'

class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

with open(input_file , 'r') as f:
    data = f.read()
urls = re.findall(r'([^ ]*?\.asmx)', data)

for url in urls:
    response = requests.get(baseUrl + url, cookies = {"[Cookie_Name]" : cookie})
    if response.status_code == 200:
#        print '[+] {0}'.format(url)
        methods = re.findall(r'<a href=\"([^\"]*?)\"', response.content)
        for method in methods:
            if "?op=" in method:
                m = requests.get(baseUrl + method, cookies = {"[Cookie_Name]" : cookie})
                if m.status_code == 200:
                    if str(search) in m.content:
                        print bcolors.OKGREEN + "[+] " + str(method) + bcolors.ENDC
